<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="RemittanceLogMapper">
	
	<!-- 列表(全部) -->
	<select id="sumAll" parameterType="pd" resultType="pd">
		select
				IFNULL(sum(a.MONEY),0) MONEY
		from 
				REMITTANCE_LOG a
		where   1=1
			<if test="MONTH!=null and MONTH!=''">
				AND a.CREATE_TIME  LIKE CONCAT( #{MONTH} ,'%')
			</if>
			<if test="USER_ID!=null and USER_ID!=''">
				AND a.USER_ID=#{USER_ID}
			</if>
			<if test="sendTimeBegin!=null and sendTimeBegin!='' ">
				AND a.CREATE_TIME LIKE CONCAT( #{sendTimeBegin} ,'%')
			</if>
			<if test="sendTimeEnd!=null and sendTimeEnd!='' ">
				AND a.CREATE_TIME LIKE CONCAT( #{sendTimeEnd} ,'%')
			</if>
	</select>
	<!-- 新增-->
	<insert id="save" parameterType="pd">
		insert into REMITTANCE_LOG(
			USER_ID,	
			ACCOUNT_NAME,	
			CARD_NUM,	
			OPEN_CARD,	
			MONEY,	
			CHANNEL_ACCOUNT_NAME,	
			CHANNEL_CARD_NUM,	
			STATE,	
			MEMO,	
			CHECK_TIME,	
			CREATE_TIME
		) values (
			#{USER_ID},	
			#{ACCOUNT_NAME},	
			#{CARD_NUM},	
			#{OPEN_CARD},	
			#{MONEY},	
			#{CHANNEL_ACCOUNT_NAME},	
			#{CHANNEL_CARD_NUM},	
			#{STATE},	
			#{MEMO},	
			#{CHECK_TIME},	
			#{CREATE_TIME}
		)
	</insert>
	
	
	<!-- 删除-->
	<delete id="delete" parameterType="pd">
		delete from REMITTANCE_LOG
		where 
			REMITTANCE_LOG_ID = #{REMITTANCE_LOG_ID}
	</delete>
	
	
	<!-- 修改 -->
	<update id="edit" parameterType="pd">
		update  REMITTANCE_LOG
			set 
				ACCOUNT_NAME = #{ACCOUNT_NAME},
				CARD_NUM = #{CARD_NUM},
				OPEN_CARD = #{OPEN_CARD},
				MONEY = #{MONEY},
				CHANNEL_ACCOUNT_NAME = #{CHANNEL_ACCOUNT_NAME},
				CHANNEL_CARD_NUM = #{CHANNEL_CARD_NUM},
				STATE = #{STATE},
				MEMO = #{MEMO},
				CHECK_TIME = #{CHECK_TIME}
			where 
				REMITTANCE_LOG_ID = #{REMITTANCE_LOG_ID}
	</update>
	
	
	<!-- 通过ID获取数据 -->
	<select id="findById" parameterType="pd" resultType="pd">
		select 
			REMITTANCE_LOG_ID,	
			USER_ID,	
			ACCOUNT_NAME,	
			CARD_NUM,	
			OPEN_CARD,	
			MONEY,	
			CHANNEL_ACCOUNT_NAME,	
			CHANNEL_CARD_NUM,	
			STATE,	
			MEMO,	
			CHECK_TIME,	
			CREATE_TIME
		from 
			REMITTANCE_LOG
		where 
			REMITTANCE_LOG_ID = #{REMITTANCE_LOG_ID}
	</select>
	
	
	<!-- 列表 -->
	<select id="datalistPage" parameterType="page" resultType="pd">
		select
				a.REMITTANCE_LOG_ID,	
				a.USER_ID,	
				a.ACCOUNT_NAME,	
				a.CARD_NUM,	
				a.OPEN_CARD,	
				a.MONEY,	
				a.CHANNEL_ACCOUNT_NAME,	
				a.CHANNEL_CARD_NUM,	
				a.STATE,	
				a.MEMO,	
				a.CHECK_TIME,	
				a.CREATE_TIME,
				u.COMPANY,
				u.INCOMES,
				u.NAME,
				u.RECHARGES,
				u.SURPLUS,
				u.INCOMES-SURPLUS WITHDRAW
		from 
				REMITTANCE_LOG a,SYS_USER u
		where   a.USER_ID=u.USER_ID
			<if test="pd.STATE!=null and pd.STATE!=''">
				AND a.STATE=#{pd.STATE}
			</if>
			<if test="pd.USER_ID!=null and pd.USER_ID!=''">
				AND a.USER_ID=#{pd.USER_ID}
			</if>
			<if test="pd.sendTimeBegin!=null and pd.sendTimeBegin!='' ">
				AND a.CREATE_TIME>=#{pd.sendTimeBegin}
			</if>
			<if test="pd.sendTimeEnd!=null and pd.sendTimeEnd!='' ">
			  <![CDATA[   
				AND a.CREATE_TIME <= #{pd.sendTimeEnd}
			 ]]>   
			</if>
			<if test="pd.names!=null and pd.names!=''">
				AND (
					a.ACCOUNT_NAME LIKE CONCAT('%', #{pd.names} ,'%')
					or
					u.NAME LIKE CONCAT('%', #{pd.names} ,'%')
				)
			</if>
			ORDER BY a.REMITTANCE_LOG_ID desc
	</select>
	
	<!-- 列表(全部) -->
	<select id="listAll" parameterType="pd" resultType="pd">
		select
				a.REMITTANCE_LOG_ID,	
				a.USER_ID,	
				a.ACCOUNT_NAME,	
				a.CARD_NUM,	
				a.OPEN_CARD,	
				a.MONEY,	
				a.CHANNEL_ACCOUNT_NAME,	
				a.CHANNEL_CARD_NUM,	
				a.STATE,	
				a.MEMO,	
				a.CHECK_TIME,	
				a.CREATE_TIME,
				u.COMPANY,
				u.INCOMES,
				u.NAME,
				u.RECHARGES,
				u.SURPLUS,
				u.INCOMES-SURPLUS WITHDRAW
		from 
				REMITTANCE_LOG a,SYS_USER u
		where   a.USER_ID=u.USER_ID
			<if test="STATE!=null and STATE!=''">
				AND a.STATE=#{STATE}
			</if>
			<if test="USER_ID!=null and USER_ID!=''">
				AND a.USER_ID=#{USER_ID}
			</if>
			<if test="sendTimeBegin!=null and sendTimeBegin!='' ">
				AND a.CREATE_TIME>=#{sendTimeBegin}
			</if>
			<if test="sendTimeEnd!=null and sendTimeEnd!='' ">
			  <![CDATA[   
				AND a.CREATE_TIME <= #{sendTimeEnd}
			 ]]>   
			</if>
			<if test="names!=null and names!=''">
				AND (
					a.ACCOUNT_NAME LIKE CONCAT('%', #{names} ,'%')
					or
					u.NAME LIKE CONCAT('%', #{names} ,'%')
				)
			</if>
			ORDER BY a.REMITTANCE_LOG_ID desc
	</select>
	
	<!-- 批量删除 -->
	<delete id="deleteAll" parameterType="String">
		delete from REMITTANCE_LOG
		where 
			REMITTANCE_LOG_ID in
		<foreach item="item" index="index" collection="array" open="(" separator="," close=")">
                 #{item}
		</foreach>
	</delete>
	
	
	
	<!-- 获取渠道打款信息 -->
	<select id="sysUserList" parameterType="page" resultType="pd">
		select
				a.REMITTANCE_LOG_ID,
				a.CREATE_TIME,
				su.SURPLUS,
				a.MONEY,	
				su.INCOMES-su.SURPLUS SUMMONEY,
				a.CHECK_TIME,
				a.USER_ID,	
				a.ACCOUNT_NAME,	
				a.CARD_NUM,	
				a.OPEN_CARD,	
				a.CHANNEL_ACCOUNT_NAME,	
				a.CHANNEL_CARD_NUM,	
				a.STATE,	
				a.MEMO	
		from 
				REMITTANCE_LOG a
				LEFT JOIN sys_user su ON a.USER_ID = su.USER_ID
		where
				a.USER_ID = #{pd.USER_ID}
				<if test="pd.STATE!=null and pd.STATE!=''">
					AND a.STATE = #{pd.STATE}
				</if>
				<if test="pd.sendTimeBegin!=null and pd.sendTimeBegin!='' ">
					AND a.CREATE_TIME>=#{pd.sendTimeBegin}
				</if>
				<if test="pd.sendTimeEnd!=null and pd.sendTimeEnd!='' ">
				  <![CDATA[   
					AND a.CREATE_TIME <= #{pd.sendTimeEnd}
				 ]]>   
				</if>
	</select>
	<!-- 列出渠道账户信息  导出excel -->
	<select id="listsysuserAccountexcel" parameterType="pd" resultType="pd">
		select
				a.REMITTANCE_LOG_ID,
				a.CREATE_TIME,
				su.SURPLUS,
				a.MONEY,	
				su.INCOMES-su.SURPLUS SUMMONEY,
				a.CHECK_TIME,
				a.STATE
		from 
				REMITTANCE_LOG a
				LEFT JOIN sys_user su ON a.USER_ID = su.USER_ID
		where a.USER_ID = #{USER_ID}
				<if test="STATE!=null and STATE!=''">
					AND a.STATE = #{STATE}
				</if>
				<if test="sendTimeBegin!=null and sendTimeBegin!='' ">
					AND a.CREATE_TIME>=#{sendTimeBegin}
				</if>
				<if test="sendTimeEnd!=null and sendTimeEnd!='' ">
				  <![CDATA[   
					AND a.CREATE_TIME <= #{sendTimeEnd}
				 ]]>   
				</if>
	</select>
</mapper>