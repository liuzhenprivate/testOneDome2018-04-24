<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="NoticeLogMapper">
	
	
	<!-- 新增-->
	<insert id="save" parameterType="pd">
		insert into NOTICELOG(
			TITLE,	
			CONTENT,	
			STATE,	
			SEND_TIME,	
			ADMIN_ID,	
			PUSHMODE,
			CTIME
		) values (
			#{TITLE},	
			#{CONTENT},	
			#{STATE},	
			#{SEND_TIME},	
			#{ADMIN_ID},
			#{PUSHMODE},
			#{CTIME}	
		)
	</insert>
	
	
	<!-- 删除-->
	<delete id="delete" parameterType="pd">
		delete from NOTICELOG
		where 
			NOTICELOG_ID = #{NOTICELOG_ID}
	</delete>
	
	
	<!-- 修改 -->
	<update id="edit" parameterType="pd">
		update  NOTICELOG
			set 
				TITLE = #{TITLE},
				CONTENT = #{CONTENT},
				STATE = #{STATE},
				PUSHMODE =#{PUSHMODE},
				SEND_TIME = #{SEND_TIME}
			where 
				NOTICELOG_ID = #{NOTICELOG_ID}
	</update>
	
	<!-- 修改 -->
	<update id="editstate" parameterType="pd">
		update  NOTICELOG
			set 
				STATE = #{STATE}
				<if test="SEND_TIME!=null and SEND_TIME!=''">
				,SEND_TIME = #{SEND_TIME}
				</if>
			where 
				NOTICELOG_ID = #{NOTICELOG_ID}
	</update>
	
	
	<!-- 通过ID获取数据 -->
	<select id="findById" parameterType="pd" resultType="pd">
		select 
			TITLE,	
			CONTENT,	
			STATE,	
			SEND_TIME,	
			ADMIN_ID,	
			CTIME,	
			PUSHMODE,
			NOTICELOG_ID
		from 
			NOTICELOG
		where 
			NOTICELOG_ID = #{NOTICELOG_ID}
	</select>
	
	
	<!-- 列表 -->
	<select id="datalistPage" parameterType="page" resultType="pd">
		select
				a.TITLE,	
				a.CONTENT,	
				a.STATE,	
				SUBSTRING(a.SEND_TIME , 1 , 10) SEND_TIME,	
				a.ADMIN_ID,	
				a.CTIME,	
				a.PUSHMODE,
				a.NOTICELOG_ID,
				b.USERNAME
		from 
				NOTICELOG a,SYS_USER b
		where   a.ADMIN_ID = b.USER_ID
				<if test="pd.STATE != null and  pd.STATE != ''">
					AND a.STATE = ${pd.STATE}
				</if>
				<if test="pd.PUSHMODE != null and  pd.PUSHMODE != ''">
					AND a.PUSHMODE = ${pd.PUSHMODE}
				</if>
				<if test="pd.sendTimeBegin!=null and pd.sendTimeBegin!='' ">
					AND a.SEND_TIME>=#{pd.sendTimeBegin}
				</if>
				<if test="pd.sendTimeEnd!=null and pd.sendTimeEnd!='' ">
				  <![CDATA[   
					AND a.SEND_TIME <= #{pd.sendTimeEnd}
				 ]]>   
				</if>
		order by a.NOTICELOG_ID desc
	</select>
	
	<!-- 列表(全部) -->
	<select id="listAll" parameterType="pd" resultType="pd">
		select
				a.TITLE,	
				a.CONTENT,	
				a.STATE,	
				SUBSTRING(a.SEND_TIME , 1 , 10) SEND_TIME,	
				a.ADMIN_ID,	
				a.CTIME,	
				a.NOTICELOG_ID,
				b.USERNAME
		from 
				NOTICELOG a,SYS_USER b
		where   a.ADMIN_ID = b.USER_ID
				<if test="STATE != null and  STATE != ''">
					AND a.STATE = ${STATE}
				</if>
				<if test="PUSHMODE != null and  PUSHMODE != ''">
					AND a.PUSHMODE = ${PUSHMODE}
				</if>
				<if test="sendTimeBegin!=null and sendTimeBegin!='' ">
					AND a.SEND_TIME>=#{sendTimeBegin}
				</if>
				<if test="sendTimeEnd!=null and sendTimeEnd!='' ">
				  <![CDATA[   
					AND a.SEND_TIME <= #{sendTimeEnd}
				 ]]>   
				</if>
		order by a.NOTICELOG_ID desc
	</select>
	
	<!-- 批量删除 -->
	<delete id="deleteAll" parameterType="String">
		delete from NOTICELOG
		where 
			NOTICELOG_ID in
		<foreach item="item" index="index" collection="array" open="(" separator="," close=")">
                 #{item}
		</foreach>
	</delete>
	
	<!-- 渠道公告列表 -->
	<select id="sysUserlistPage" parameterType="page" resultType="pd">
		select
				a.TITLE,	
				a.CONTENT,	
				a.STATE,	
				a.SEND_TIME,	
				a.ADMIN_ID,	
				a.CTIME,	
				a.PUSHMODE,
				a.NOTICELOG_ID
		from 
				NOTICELOG a
		where   a.SEND_TIME >= #{pd.TIME} AND STATE = 3
				<if test="pd.sendTimeBegin!=null and pd.sendTimeBegin!='' ">
					AND a.SEND_TIME>=#{pd.sendTimeBegin}
				</if>
				<if test="pd.sendTimeEnd!=null and pd.sendTimeEnd!='' ">
				  <![CDATA[   
					AND a.SEND_TIME <= #{pd.sendTimeEnd}
				 ]]>   
				</if>
		order by a.NOTICELOG_ID desc
	</select>
	
</mapper>