package com.sinontech.service.impl;


import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.sinontech.dao.impl.CountDayDaoImpl;
import com.sinontech.dao.impl.CountMonthDaoImpl;
import com.sinontech.dao.impl.CountWeekDaoImpl;
import com.sinontech.modle.CountDay;
import com.sinontech.modle.CountMonth;
import com.sinontech.modle.CountWeek;
import com.sinontech.pub.utils.DateUtil;
import com.sinontech.service.CountService;

@Service("countservice")
public class CountServiceImpl implements CountService{

	@Autowired
	CountMonthDaoImpl countMonthDaoImpl;
	@Autowired
	CountWeekDaoImpl countWeekDaoImpl;
	@Autowired
	CountDayDaoImpl countDayDaoImpl;
	
	public CountDay getCountDayByCountDate(long webchatid, String countDay) {
		return this.countDayDaoImpl.getCountDayByCountDate(webchatid, countDay);
	}
	public CountMonth getCountMonthByCountDate(long webchatid, String countMonth) {
		return this.countMonthDaoImpl.getCountMonthByCountDate(webchatid, countMonth);
	}
	public CountWeek getCountWeekByCountDate(long webchatid, String stratDate,
			String endDate) {
		return this.countWeekDaoImpl.getCountWeekByCountDate(webchatid, stratDate, endDate);
	}
	public void saveCountDay(CountDay countDay) {
		this.countDayDaoImpl.saveCountDay(countDay);
	}
	public void saveCountMonth(CountMonth countMonth) {
		this.countMonthDaoImpl.saveCountMonth(countMonth);
	}
	public void saveCountWeek(CountWeek countWeek) {
		this.countWeekDaoImpl.saveCountWeek(countWeek);
	}
	public void updateCountDay(CountDay countDay) {
		this.countDayDaoImpl.updateCountDay(countDay);
	}
	public void updateCountMonth(CountMonth countMonth) {
		this.countMonthDaoImpl.updateCountMonth(countMonth);
	}
	public void updateCountWeek(CountWeek countWeek) {
		this.countWeekDaoImpl.updateCountWeek(countWeek);
	}
	
	public void addBookCurrency(long channelId,long webchatid, long bookCurrency,long bookCurrencyGift,
			long recharges,long users) {
		String time = DateUtil.getStringNow();
		String month = DateUtil.getStringMonth();
		String day = DateUtil.getStringShortNow(); 
		String sunday = DateUtil.getSundayOfThisWeek();
		String monday = DateUtil.getMondayOfThisWeek();
		CountDay countday = this.countDayDaoImpl.getCountDayByCountDate(webchatid, day);
		if(null!=countday){
			countday.setBookCurrency(bookCurrency+countday.getBookCurrency());
			countday.setBookCurrencyGift(bookCurrencyGift+countday.getBookCurrencyGift());
			countday.setUsers(countday.getUsers()+users);
			countday.setRecharges(recharges+countday.getRecharges());
			countday.setUpdateTime(time);
			this.countDayDaoImpl.updateCountDay(countday);
		}else{
			countday = new CountDay();
			countday.setChannelId(channelId);
			countday.setBookCurrency(bookCurrency );
			countday.setBookCurrencyGift(bookCurrencyGift );
			countday.setUsers( users);
			countday.setRecharges(recharges );
			countday.setUpdateTime(time);
			countday.setWebchatId(webchatid);
			countday.setCreateTime(time);
			countday.setCountDay(day);
			this.countDayDaoImpl.saveCountDay(countday);
		}
		CountWeek week = this.countWeekDaoImpl.getCountWeekByCountDate(webchatid, monday, sunday);
		if(null!=week){
			week.setBookCurrency(bookCurrency+week.getBookCurrency());
			week.setBookCurrencyGift(bookCurrencyGift+week.getBookCurrencyGift());
			week.setUsers(week.getUsers()+users);
			week.setRecharges(recharges+week.getRecharges());
			week.setUpdateTime(time);
			this.countWeekDaoImpl.updateCountWeek(week);
		}else{
			week = new CountWeek();
			week.setChannelId(channelId);
			week.setBookCurrency(bookCurrency );
			week.setBookCurrencyGift(bookCurrencyGift );
			week.setUsers( users);
			week.setRecharges(recharges );
			week.setUpdateTime(time);
			week.setWebchatId(webchatid);
			week.setCreateTime(time);
			week.setStratDate(monday);
			week.setEndDate(sunday);
			this.countWeekDaoImpl.saveCountWeek(week);
		}
		CountMonth cmonth  = this.countMonthDaoImpl.getCountMonthByCountDate(webchatid, month);
		if(null!=cmonth){
			cmonth.setBookCurrency(bookCurrency+cmonth.getBookCurrency());
			cmonth.setBookCurrencyGift(bookCurrencyGift+cmonth.getBookCurrencyGift());
			cmonth.setUsers(cmonth.getUsers()+users);
			cmonth.setRecharges(recharges+cmonth.getRecharges());
			cmonth.setUpdateTime(time);
			this.countMonthDaoImpl.updateCountMonth(cmonth);
		}else{
			cmonth =new CountMonth();
			cmonth.setChannelId(channelId);
			cmonth.setBookCurrency(bookCurrency );
			cmonth.setBookCurrencyGift(bookCurrencyGift );
			cmonth.setUsers( users);
			cmonth.setRecharges(recharges );
			cmonth.setUpdateTime(time);
			cmonth.setWebchatId(webchatid);
			cmonth.setCreateTime(time);
			cmonth.setCountMonth(month);
			this.countMonthDaoImpl.saveCountMonth(cmonth);
			
		}
		
	}
	 

	 
	  
	
	
}
